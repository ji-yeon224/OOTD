
<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/155a5f0d-35eb-4013-b34c-62affc336fc3" width="20%"/>

# ğŸ‘• OOTD

<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/f779e1b1-e0b4-43f7-bc3a-06ffc2328653" width="80%"/>
</br>

## ğŸ—“ï¸ í”„ë¡œì íŠ¸
- ê°œì¸ í”„ë¡œì íŠ¸
- 2023.11.13 ~ 2023.12.23
</br>
  

## âœï¸ í•œ ì¤„ ì†Œê°œ
-  ì‚¬ìš©ìë“¤ ê°„ ì˜· ì •ë³´ë¥¼ ê³µìœ í•  ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹° ì–´í”Œë¦¬ì¼€ì´ì…˜

</br>


## ğŸ’» ê¸°ìˆ  ìŠ¤íƒ
- `MVVM`
- `RxSwift`, `RxDataSource`
- `UIKit`
- `Moya`, `Codable`, `Kingfisher`
- `Snapkit`, `AutoLayout`
- `DiffableDataSource`, `CompositionalLayout`
- `Tabman`, `Toast`, `IQKeyboardManager`

</br>

## ğŸ“– í”„ë¡œì íŠ¸ ëª©í‘œ

- ì„œë²„ì™€ì˜ í†µì‹ ì„ í†µí•´ `Error Handling` 
- `Moya Intercepter`ë¥¼ í†µí•´ JWT Token ê´€ë¦¬í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬
- `RxSwift`ì™€ `MVVM` `Input-Ouput íŒ¨í„´`ì„ ì ìš©í•˜ì—¬ ì½”ë“œì˜ ê°€ë…ì„± ë†’ì´ê¸°
</br>


##  ğŸ” ì£¼ìš” ê¸°ëŠ¥
### âœ”ï¸ íšŒì›ê°€ì…, ë¡œê·¸ì¸
<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/32588db8-d6d1-4692-88c7-04dedbfdac8d" width="80%"/>

- ì´ë©”ì¼ ìœ íš¨ì„± ì²´í¬ apië¥¼ í†µí•´ ì„œë²„ ë‚´ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì¸ì§€ í™•ì¸í•˜ë„ë¡ í•˜ì˜€ë‹¤.
</br>

### âœ”ï¸ JWT Token ê´€ë¦¬
- `Alamofire Intercepter`ë¥¼ ì´ìš©í•˜ì—¬ token ê°’ì´ ìœ íš¨í•œì§€ ì²´í¬í•˜ì—¬ í† í° ê°±ì‹ ì„ í•˜ê±°ë‚˜ refresh tokenì´ ë§Œë£Œëì„ ì‹œ ë‹¤ì‹œ ë¡œê·¸ì¸ í•˜ë„ë¡ ìœ ë„í•˜ì˜€ë‹¤.
</br>

### âœ”ï¸ ê²Œì‹œë¬¼ ì‘ì„± ë° ì¡°íšŒ, ëŒ“ê¸€ ì‘ì„±
<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/3db28b84-e702-434f-9d2d-5e4c4f3effd1" width="90%"/>

- `Compositional Layout`ê³¼ `RxDataSource`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ CollectionViewì™€ TableViewë¥¼ í†µí•´ êµ¬í˜„í•˜ì˜€ë‹¤. 
- `PHPickerViewController`ë¥¼ í†µí•´ ê²Œì‹œë¬¼ ì‘ì„± ì‹œ ì‚¬ìš©ìì˜ ì•¨ë²”ì— ìˆëŠ” ì‚¬ì§„ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤. 
</br>

### âœ”ï¸ ë‚´ ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì •
<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/32caaec8-a942-48cf-8285-997f343bccd4" width="80%"/>

- `Tabman` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ì„ ì¹´í…Œê³ ë¦¬ ë³„ë¡œ ë‚˜ëˆ  ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤. 

</br>



## ğŸš¨ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### ì´ë¯¸ì§€ ìºì‹±
- `Kingfisher`ë¥¼ ì´ìš©í•˜ì—¬ ê²Œì‹œíŒì˜ ì´ë¯¸ì§€ ì¸ë„¤ì¼ ë¡œë“œ ì‹œ ë©”ëª¨ë¦¬ë¥¼ ìµœëŒ€ 300MBê¹Œì§€ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤. 
- Kingfisherì—ì„œ ì œê³µí•˜ëŠ” ì´ë¯¸ì§€ ìºì‹± ê¸°ëŠ¥ì„ í†µí•´ ì´ë¯¸ ìºì‹±ë˜ì–´ ìˆëŠ” ì´ë¯¸ì§€ë¼ë©´ ìºì‹± ë°ì´í„°ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•˜ì—¬ ë³´ì—¬ì£¼ê³ , ìºì‹±ë˜ì§€ ì•Šì€ ì´ë¯¸ì§€ëŠ” ìƒˆë¡œ ë‹¤ìš´ë¡œë“œ í•˜ì—¬ ìºì‹œ ë°ì´í„°ë¡œ ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ë”ë‹ˆ ì´ë¯¸ì§€ ë¡œë“œ ì‹œ ì•½ 74MBê¹Œì§€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆì—ˆë‹¤.

```swift 
func setImage(with urlString: String, resize width: CGFloat? = nil, cornerRadius: CGFloat = 15, completion: (() -> Void)? = nil) {

Â  Â  Â  Â  let cornerImageProcessor = RoundCornerImageProcessor(cornerRadius: cornerRadius)
Â  Â  Â  Â  ImageCache.default.retrieveImage(forKey: urlString, options: [
Â  Â  Â  Â  Â  Â  .requestModifier(ImageLoadManager.shared.getModifier()),
Â  Â  Â  Â  Â  Â  .transition(.fade(1.0)),
Â  Â  Â  Â  Â  Â  .processor(cornerImageProcessor)
Â  Â  Â  Â  ]) { [weak self] result in
Â  Â  Â  Â  Â  Â  guard let self = self else { return }
Â  Â  Â  Â  Â  Â  self.kf.indicatorType = .activity
Â  Â  Â  Â  Â  Â  switch result {
Â  Â  Â  Â  Â  Â  case .success(let value):
	Â  Â  Â  Â  Â  Â  // ìºì‹œëœ ë°ì´í„°ê°€ ì¡´ì¬í•˜ë©´
Â  Â  Â  Â  Â  Â  Â  Â  if let image = value.image {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.image = image.resize(width: width)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completion?()

Â  Â  Â  Â  Â  Â  Â  Â  } else { // ìºì‹œëœ ë°ì´í„°ê°€ ì—†ë‹¤ë©´
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  guard let url = URL(string: self.getPhotoURL(urlString)) else { return }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let resource = ImageResource(downloadURL: url, cacheKey: urlString)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.kf.setImage(with: resource, options: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .requestModifier(ImageLoadManager.shared.getModifier()),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .transition(.fade(1.0)),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .processor(cornerImageProcessor)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]) { [weak self] result in
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  guard let self = self else { return }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch result {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case .success(let result):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.image = result.image.resize(width: width)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completion?()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case .failure(_):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.image = Constants.Image.errorPhoto?.withTintColor(Constants.Color.background)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  case .failure(let error):
	Â  Â  Â  Â  Â  Â  self.image = Constants.Image.errorPhoto?.withTintColor(Constants.Color.background)
Â  Â  Â  Â  Â  Â  Â  Â  debugPrint(error)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
```


### PHPickerViewController ì‚¬ì§„ ë¡œë“œ ì‹œ ë©”ëª¨ë¦¬ ê³¼ì‚¬ìš©

- `PHPickerViewController`ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ì•¨ë²”ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ë©”ëª¨ë¦¬ê°€ ì‚¬ìš©ëœ í›„ ë©”ëª¨ë¦¬ê°€ í•´ì œ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤. 
- PHPickerViewControllerë¥¼ PHPickerMangerë¥¼ í†µí•´ `ì‹±ê¸€í†¤`ìœ¼ë¡œ ìƒì„±í•˜ì—¬ present & dismissë¡œ êµ¬í˜„í•˜ì—¬ ë©”ëª¨ë¦¬ê°€ í•´ì œë˜ë„ë¡ í•˜ì˜€ë‹¤. 
- ì„ íƒí•œ ì´ë¯¸ì§€ëŠ” `RxSwift PublishSubject`ë¥¼ í†µí•´ ì „ë‹¬í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.
```swift
final class PHPickerManager {

Â  Â  static let shared = PHPickerManager()
Â  Â  private init() { }

Â  Â  private weak var viewController: UIViewController?
Â  Â  private var fullScreenType: Bool = false
Â  Â  private let group = DispatchGroup()
Â  Â  
Â  Â  let selectedImage = PublishSubject<[UIImage]>()
Â  Â  var disposeBag = DisposeBag()

Â  Â  func presentPicker(vc: UIViewController, selectLimit: Int = 1, fullScreenType: Bool) {

Â  Â  Â  Â  self.viewController = vc
Â  Â  Â  Â  self.fullScreenType = fullScreenType
Â  Â  Â  Â  self.disposeBag = DisposeBag()
Â  Â  Â  Â  
Â  Â  Â  Â  let filter = PHPickerFilter.images
Â  Â  Â  Â  var configuration = PHPickerConfiguration(photoLibrary: .shared())
Â  Â  Â  Â  ... // PHPicker configuration

Â  Â  Â  Â  let picker = PHPickerViewController(configuration: configuration)
Â  Â  Â  Â  picker.delegate = self
Â  Â  Â  Â  viewController?.present(picker, animated: true)

Â  Â  }

}

extension PHPickerManager: PHPickerViewControllerDelegate {

Â  Â  func picker(_ picker: PHPickerViewController, didFinishPicking results: [PHPickerResult]) {
Â  Â  Â  Â  var imgList: [UIImage] = []

Â  Â  Â  Â  guard let viewController else {return}
Â  Â  Â  Â  if results.isEmpty {
Â  Â  Â  Â  Â  Â  viewController.dismiss(animated: true)
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  results.forEach {
Â  Â  Â  Â  Â  Â  Â  Â  self.group.enter()
Â  Â  Â  Â  Â  Â  Â  Â  let item = $0.itemProvider
Â  Â  Â  Â  Â  Â  Â  Â  item.loadObject(ofClass: UIImage.self) { image, error in
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DispatchQueue.main.async {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  guard let img = image as? UIImage else { return }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgList.append(img)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.group.leave()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â // loadObjectê°€ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— dispatchGroupì„ í†µí•´ ì´ë¯¸ì§€ í•œ ë²ˆì— ì „ë‹¬
Â  Â  Â  Â  Â  Â  group.notify(queue: DispatchQueue.main) {
Â  Â  Â  Â  Â  Â  Â  Â  self.selectedImage.onNext(imgList)
Â  Â  Â  Â  Â  Â  Â  Â  self.viewController?.dismiss(animated: !self.fullScreenType)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
```

<img src = "https://github.com/ji-yeon224/OOTD/assets/69784492/666121f5-3398-421b-9416-1c3ce8e00a3f" width="85%"/>

### Codable TypeMismatch
- ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ ì¤‘ ì„œë²„ì—ì„œ ì‘ë‹µë°›ì€ ì»¤ì„œ ê°’ì´ ë§ˆì§€ë§‰ í˜ì´ì§€ì¼ ë•ŒëŠ” Intë¡œ, ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆì„ ë•ŒëŠ” Stringìœ¼ë¡œ ë°˜í™˜í•˜ì—¬ **ë””ì½”ë”© TypeMismatch ì˜¤ë¥˜**ê°€ ë°œìƒí•˜ì˜€ë‹¤. 
-  **init** êµ¬ë¬¸ì„ í†µí•´ ì „ë‹¬ ë°›ì€ ê°’ì˜ íƒ€ì…ì„ ì²´í¬í•˜ì—¬ ì˜ˆì™¸ì²˜ë¦¬ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í•˜ì˜€ë‹¤.
- ì‘ë‹µ ë°ì´í„° êµ¬ì¡°ì²´ ë‚´ë¶€ì—ì„œ init êµ¬ë¬¸ì„ í†µí•´ í™•ì¸ ì‹œ ì‘ë‹µ ë°›ì„ ë°ì´í„° ëª¨ë‘ ì²´í¬í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆì—ˆê³ , `PropertyWrapper`ë¥¼ í†µí•´ ì›í•˜ëŠ” ë°ì´í„°ì˜ íƒ€ì…ë§Œ ì²´í¬í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.
```swift
@propertyWrapper
struct NextCursorType {
    var wrappedValue: String
}

extension NextCursorType: Codable {
    init(from decoder: Decoder) throws {
        let container = try decoder.singleValueContainer()
        if let nextCursor = try? container.decode(String.self) {
            wrappedValue = nextCursor
        } else {
            wrappedValue = "0"
        }
    }
}
```

```swift
struct ReadResponse: Codable {
    let data: [Post]
    @NextCursorType var nextCursor: String

    enum CodingKeys: String, CodingKey {
        case data
        case nextCursor = "next_cursor"
    }
    
}
```
### invalidateLayout
- `RxDataSource`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…€ì— ì„œë²„ì—ì„œ ë°›ì€ ì´ë¯¸ì§€ë¥¼ ì ìš©í•  ë•Œ ì´ë¯¸ì§€ì˜ í¬ê¸° ì¡°ì ˆì´ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤. Kingfisherë¥¼ í†µí•´ ë‹¤ìš´ ë°›ëŠ” ì´ë¯¸ì§€ëŠ” **ë¹„ë™ê¸°ë¡œ ë™ì‘**í•˜ê¸° ë•Œë¬¸ì— ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì§€ ì•Šì€ ì±„ë¡œ imageViewì˜ layoutì„ ì¡ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ë¬¸ì œì˜€ë‹¤.
- ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ë©´ completion handlerë¥¼ í†µí•´ ì•Œë¦¬ê³ , `invalidateLayout`ì„ í˜¸ì¶œí•˜ì—¬ **CollectionView ë ˆì´ì•„ì›ƒì„ ì¬êµ¬ì„±**í•˜ë„ë¡ í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.
```swift
lazy var dataSource = RxCollectionViewSectionedReloadDataSource<PostListModel> { dataSource, collectionView, indexPath, item in
Â  Â  Â  Â  guard let cell = collectionView.dequeueReusableCell(withReuseIdentifier: OOTDCollectionViewCell.identifier, for: indexPath) as? OOTDCollectionViewCell else { return UICollectionViewCell()}

Â  Â  Â  Â  if item.image.count > 0 {
Â  Â  Â  Â  Â  Â  cell.imageView.setImage(with: item.image[0], resize: Constants.Design.deviceWidth, cornerRadius: 0 ) {
Â  Â  Â  Â  Â  Â  Â  Â  collectionView.collectionViewLayout.invalidateLayout()
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }
}
```
